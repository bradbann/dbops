<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- App favicon -->
        <link rel="shortcut icon" href="{{static_url('assets/images/favicon.ico')}}">
        <!-- App title -->
        <title>数据库自动化运维平台</title>
        <!--Morris Chart CSS -->
		<link rel="stylesheet" href="{{static_url('plugins/morris/morris.css')}}">

        <!-- App css -->
        <link href="{{static_url('assets/css/bootstrap.min.css')}}" rel="stylesheet" type="text/css" />
        <link href="{{static_url('assets/css/core.css')}}" rel="stylesheet" type="text/css" />
        <link href="{{static_url('assets/css/components.css')}}" rel="stylesheet" type="text/css" />
        <link href="{{static_url('assets/css/icons.css')}}" rel="stylesheet" type="text/css" />
        <link href="{{static_url('assets/css/pages.css')}}" rel="stylesheet" type="text/css" />
        <link href="{{static_url('assets/css/menu.css')}}"  rel="stylesheet" type="text/css" />
        <link href="{{static_url('assets/css/responsive.css')}}" rel="stylesheet" type="text/css" />
        <link href="{{static_url('plugins/custombox/css/custombox.min.css')}}" rel="stylesheet">
		<link href="{{static_url('plugins/switchery/switchery.min.css')}}" rel="stylesheet" >
        <link href="{{static_url('plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css')}}" rel="stylesheet" >
        <link href="{{static_url('plugins/tooltipster/tooltipster.bundle.min.css')}}" rel="stylesheet" >

        <!-- Sweet Alert -->
        <link href="{{static_url('plugins/bootstrap-sweetalert/sweet-alert.css')}}" rel="stylesheet" type="text/css">

    </head>

    <body class="fixed-left">

        <!-- Begin page -->
        <div id="wrapper">

            <!-- Top Bar Start -->
            <div class="topbar">

                <!-- LOGO -->
                <div class="topbar-left">
                    <a id="windows_main" href="#" class="logo"><span>HOP<span>SON</span></span><i class="mdi mdi-layers"></i></a>
                </div>

                <!-- Button mobile view to collapse sidebar menu -->
                <div class="navbar navbar-default" role="navigation">
                    <div class="container">
                        <!-- Navbar-left -->
                        <ul class="nav navbar-nav navbar-left">
                            <li>
                                <button class="button-menu-mobile open-left waves-effect">
                                    <i class="mdi mdi-menu"></i>
                                </button>
                            </li>
                            <li class="hidden-xs">
                                <form role="search" class="app-search">
                                    <input type="text" placeholder="查询..."  class="form-control">
                                    <a href=""><i class="fa fa-search"></i></a>
                                </form>
                            </li>
                            <!--
                            <li class="hidden-xs">
                                <span>{{china_rq}}</span></label>
                            </li>

                            <li class="hidden-xs">
                               <span>{{welcome}}</span>
                            </li>
                            -->
                        </ul>

                        <!-- Right(Notification) -->
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a href="#" class="right-menu-item dropdown-toggle" data-toggle="dropdown">
                                    <i class="mdi mdi-bell"></i>
                                    <span class="badge up bg-success">3</span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-right arrow-dropdown-menu arrow-menu-right dropdown-lg user-list notify-list">
                                    <li>
                                        <h5>通知</h5>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="icon bg-info">
                                                <i class="mdi mdi-account"></i>
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">张三发布了DML操作</span>
                                                <span class="time">1小时前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="icon bg-danger">
                                                <i class="mdi mdi-comment"></i>
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">系统新增李四用户</span>
                                                <span class="time">20分钟前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="icon bg-warning">
                                                <i class="mdi mdi-settings"></i>
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">管理员新增代码</span>
                                                <span class="time">3天前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li class="all-msgs text-center">
                                        <p class="m-0"><a href="#">查看所有通知</a></p>
                                    </li>
                                </ul>
                            </li>

                            <li>
                                <a href="#" class="right-menu-item dropdown-toggle" data-toggle="dropdown">
                                    <i class="mdi mdi-email"></i>
                                    <span class="badge up bg-danger">4</span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-right arrow-dropdown-menu arrow-menu-right dropdown-lg user-list notify-list">
                                    <li>
                                        <h5>邮件</h5>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="avatar">
                                                <img src="{{static_url('assets/images/users/avatar-2.jpg')}}" alt="">
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">张三 Beach</span>
                                                <span class="desc">[合生通]卡券升级会议记录</span>
                                                <span class="time">2小时前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="avatar">
                                                <img src="{{ static_url('assets/images/users/avatar-3.jpg')}}" alt="">
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">李四</span>
                                                <span class="desc">实时车流数据同步测试</span>
                                                <span class="time">1小时前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="avatar">
                                                <img src="{{ static_url('assets/images/users/avatar-4.jpg')}}" alt="">
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">王五</span>
                                                <span class="desc">关于预生产环境升级的通知</span>
                                                <span class="time">3小时前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="user-list-item">
                                            <div class="avatar">
                                                <img src="{{ static_url('assets/images/users/avatar-7.jpg')}}" alt="">
                                            </div>
                                            <div class="user-desc">
                                                <span class="name">赵六</span>
                                                <span class="desc">生产环境上线K8S通知</span>
                                                <span class="time">5小时前</span>
                                            </div>
                                        </a>
                                    </li>
                                    <li class="all-msgs text-center">
                                        <p class="m-0"><a href="#">查看所有邮件</a></p>
                                    </li>
                                </ul>
                            </li>

                            <li class="dropdown user-box">
                                <a href="" class="dropdown-toggle waves-effect user-link" data-toggle="dropdown" aria-expanded="true">
                                    <img id='user-img-id' src="" alt="user-img" class="img-circle user-img">
                                </a>
                                <ul class="dropdown-menu dropdown-menu-right arrow-dropdown-menu arrow-menu-right user-list notify-list">
                                    <li>
                                        <h5>你好, {{username}}</h5>
                                    </li>
                                    <li><a href="javascript:void(0)" onclick="userinfo()"><i class="ti-user m-r-5"></i>用户详情</a></li>
                                    <li><a id='i_lock_screen' href="javascript:void(0)"><i class="ti-lock m-r-5"></i>锁定系统</a></li>
                                    <li><a href="/logout"><i class="ti-power-off m-r-5"></i>系统注销</a></li>
                                </ul>
                            </li>
                        </ul> <!-- end navbar-right -->
                    </div><!-- end container -->
                </div><!-- end navbar -->
            </div>
            <!-- Top Bar End -->

            <!-- ========== Left Sidebar Start ========== -->
            <div class="left side-menu">
                <div class="sidebar-inner slimscrollleft">

                    <!--- Sidemenu -->
                    <div id="sidebar-menu">
                        <ul id="ul-menu">
                        	<li class="menu-title">好生活数据库运维平台</li>
                        </ul>
                    </div>
                </div>
                <!-- Sidebar -left -->
            </div>
            <!-- Left Sidebar End -->

            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="content-page">
                <!-- Start content -->
                <div class="content">
                    <div id='main-container-div' class="container">
                    </div> <!-- container -->

                </div> <!-- content -->

                <footer class="footer text-right">
                    <div class="col-lg-3 col-md-4 col-sm-6"><span><b>作者:</b>一切随风</span></div>
                    <div class="col-lg-3 col-md-4 col-sm-6"><span><b>版本:</b>V1.0</span></div>
                    <div class="col-lg-3 col-md-4 col-sm-6"><span><b>博客:</b><a href="http://www.zhitbar.com" target="_blank">www.zhitbar.com</a></span></div>
                    <div class="col-lg-3 col-md-4 col-sm-6"><span><b>邮箱:</b>zhdn_791005@163.com</span></div>
                </footer>

            </div>
            <!-- ============================================================== -->
            <!-- End Right content here -->
            <!-- ============================================================== -->

            <!-- Right Sidebar -->
            <div class="side-bar right-bar">
                <a href="javascript:void(0);" class="right-bar-toggle">
                    <i class="mdi mdi-close-circle-outline"></i>
                </a>
                <h4 class="">Settings</h4>
                <div class="setting-list nicescroll">
                    <div class="row m-t-20">
                        <div class="col-xs-8">
                            <h5 class="m-0">Notifications</h5>
                            <p class="text-muted m-b-0"><small>Do you need them?</small></p>
                        </div>
                        <div class="col-xs-4 text-right">
                            <input type="checkbox" checked data-plugin="switchery" data-color="#7fc1fc" data-size="small"/>
                        </div>
                    </div>

                    <div class="row m-t-20">
                        <div class="col-xs-8">
                            <h5 class="m-0">API Access</h5>
                            <p class="m-b-0 text-muted"><small>Enable/Disable access</small></p>
                        </div>
                        <div class="col-xs-4 text-right">
                            <input type="checkbox" checked data-plugin="switchery" data-color="#7fc1fc" data-size="small"/>
                        </div>
                    </div>

                    <div class="row m-t-20">
                        <div class="col-xs-8">
                            <h5 class="m-0">Auto Updates</h5>
                            <p class="m-b-0 text-muted"><small>Keep up to date</small></p>
                        </div>
                        <div class="col-xs-4 text-right">
                            <input type="checkbox" checked data-plugin="switchery" data-color="#7fc1fc" data-size="small"/>
                        </div>
                    </div>

                    <div class="row m-t-20">
                        <div class="col-xs-8">
                            <h5 class="m-0">Online Status</h5>
                            <p class="m-b-0 text-muted"><small>Show your status to all</small></p>
                        </div>
                        <div class="col-xs-4 text-right">
                            <input type="checkbox" checked data-plugin="switchery" data-color="#7fc1fc" data-size="small"/>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Right-bar -->

        </div>
        <!-- END wrapper -->

        <div id="con-userinfo-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">用户详情</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" role="form">
                               <input  id="userid" type="hidden" name="userid" value={{userid}} >
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">用户名</label>
                                    </div>
                                    <div class="col-md-10">
                                        <input id="login"  type="text" class="form-control" placeholder="请输入用户名" value={{loginname}} disabled>
                                    </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">姓名</label>
                                    </div>
                                    <div class="col-md-10">
                                        <input id="user" name="user" type="text" class="form-control" placeholder="请输入姓名" value={{username}} disabled>
                                    </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">密码</label>
                                    </div>
                                    <div class="col-md-10">
                                        <input id="pass" name="pass" type="password" class="form-control" placeholder="请输入密码" value={{password}}>
                                    </div>
                               </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">性别</label>
                                    </div>
                                   <div class="col-md-10">
                                        <select class="form-control select" id="gender" name="gender" disabled>
                                            {% if gender=='1' %}
                                                <option value="1" selected = "selected">男</option>
                                                <option value="2">女</option>
                                            {% end %}
                                            {% if gender=='2' %}
                                                <option value='2' selected = "selected">女</option>
                                                <option value={{gender}}>男</option>
                                            {% end %}
                                        </select>
                                   </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">部门</label>
                                    </div>
                                   <div class="col-md-10">
                                        <select class="form-control select" id="dept" name="dept" disabled>
                                           {% for var in depts %}
                                               {% if dept==var[0] %}
                                                  <option value={{var[0]}} selected = "selected">{{var[1]}}</option>
                                               {% else %}
                                                  <option value={{var[0]}} >{{var[1]}}</option>
                                               {% end  %}
                                          {% end %}
                                        </select>
                                   </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">电子邮箱</label>
                                    </div>
                                    <div class="col-md-10">
                                        <input id="email" name="email" type="text" class="form-control" placeholder="请输入电子邮箱" value={{email}}>
                                    </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">联系方式</label>
                                    </div>
                                    <div class="col-md-10">
                                        <input id="phone" name="phone" type="text" class="form-control" placeholder="请输入联系方式" value={{phone}}>
                                    </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">过期日期</label>
                                    </div>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <input  id="expire_date" name="expire_date" type="text" disabled class="form-control datepicker" placeholder="yyyy/mm/dd" id="datepicker" value={{expire_date}}>
                                            <span class="input-group-addon bg-custom b-0"><i class="mdi mdi-calendar text-white"></i></span>
                                        </div>
                                    </div>
                                </div>
                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">用户状态</label>
                                    </div>
                                   <div class="col-md-10">
                                        <select class="form-control select" id="status" name="status" disabled>
                                            {% if status=='1' %}
                                                <option value="1" selected = "selected">启用</option>
                                                <option value="0">禁用</option>
                                            {% end %}
                                            {% if status=='0' %}
                                                <option value="1" >启用</option>
                                                <option value="0" selected = "selected">禁用</option>
                                            {% end %}
                                        </select>
                                   </div>
                               </div>

                               <div class="form-group">
                                    <div>
                                        <label class="col-md-2 control-label">用户角色</label>
                                    </div>
                                    <div class="col-md-10">
                                        <select multiple="multiple" class="form-control" id="sele_role_priv" name="roles" >
                                          {% for var in user_roles %}
                                             <option value={{var[0]}} >{{var[1]}}</option>
                                          {% end %}
                                        </select>
                                    </div>
                               </div>
                           </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-info waves-effect waves-light" id='btn-user-change'>变更</button>
                    </div>
                </div>
            </div>
        </div><!-- /.modal -->

        <div id="custom-modal" class="modal-demo">

            <div class="custom-modal-text">
                <div class="row">
                    <div class="account-content">
                        <div class="text-center m-b-20">
                            <div class="m-b-20">
                                 <input  id="image_path" type="hidden" value="{{file_path}}" >
                                 <input  id="image_file" type="hidden" value="{{file_name}}">
                                 <img id='account-img-id' src="" class="img-circle img-thumbnail thumb-lg" alt="thumbnail">
                            </div>
                            <p class="text-muted m-b-0 font-13">输入密码访问. </p>
                        </div>
                        <form class="form-horizontal" action="#">
                            <div class="form-group">
                                <div class="col-xs-12">
                                    <input id='unlock_password' class="form-control" type="password" placeholder="">
                                </div>
                            </div>
                            <div class="form-group account-btn text-center m-t-10">
                                <div class="col-xs-12">
                                    <button id='unlock-btn' class="btn w-md btn-bordered btn-danger waves-effect waves-light" >解锁</button>
                                </div>
                            </div>
                        </form>
                        <div class="clearfix"></div>
                    </div>

                    <div class="col-sm-12 text-center">
                        <p class="text-muted">没有登陆，请先<a href="/" class="text-primary m-l-5"><b>登陆</b></a></p>
                    </div>

                </div>
            </div>
        </div>

        <!-- End row -->

        <script>
            var resizefunc = [];
        </script>

        <!-- jQuery  -->
        <script src="{{static_url('assets/js/jquery.min.js')}}"></script>
        <script>
              $.ajax({
                      url: "/tree",
                      type: "post",
                      datatype: "json",
                      async:false,
                      data:{},
                      success: function (dataSet) {
                        //console.log(dataSet.code, dataSet.message);
                        $("#ul-menu").append(dataSet.message);
                     }
                });

               $('#main-container-div').load("/main", function() {
              });
        </script>

        <script src="{{static_url('assets/js/bootstrap.min.js')}}"></script>
        <script src="{{static_url('assets/js/detect.js')}}"></script>

        <script src="{{static_url('assets/js/fastclick.js')}}"></script>
        <script src="{{static_url('assets/js/jquery.blockUI.js')}}"></script>
        <script src="{{static_url('assets/js/waves.js')}}"></script>
        <script src="{{static_url('assets/js/jquery.slimscroll.js')}}"></script>
        <script src="{{static_url('assets/js/jquery.scrollTo.min.js')}}"></script>
        <script src="{{static_url('plugins/switchery/switchery.min.js')}}"></script>

        <!-- Counter js  -->
        <script src="{{static_url('plugins/waypoints/jquery.waypoints.min.js')}}"></script>
        <script src="{{static_url('plugins/counterup/jquery.counterup.min.js')}}"></script>
        <script src="{{static_url('plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js')}}"></script>

        <!--Morris Chart-->
		<script src="{{static_url('plugins/morris/morris.min.js')}}"></script>
		<script src="{{static_url('plugins/raphael/raphael-min.js')}}"></script>

        <!-- Sweet-Alert  -->
        <script src="{{static_url('plugins/bootstrap-sweetalert/sweet-alert.min.js')}}"></script>

        <!-- Modal-Effect -->
        <script src="{{static_url('plugins/custombox/js/custombox.min.js')}}"></script>
        <script src="{{static_url('plugins/custombox/js/legacy.min.js')}}"></script>

        <!-- tooltipster -->
        <script src="{{static_url('plugins/tooltipster/tooltipster.bundle.min.js')}}"></script>

        <!-- App js -->
        <script src="{{static_url('assets/js/jquery.core.js')}}"></script>
        <script src="{{static_url('assets/js/jquery.app.js')}}"></script>

        <script>
            $(document).bind("keydown", function(e) {//文档绑定键盘按下事件
                e = window.event || e;//解决浏览器兼容的问题
                if(e.keyCode == 116) {//F5按下
                　　e.keyCode = 0;
                　　return false;
                }
            });

            function userinfo() {
               $('#con-userinfo-modal').modal({
                 keyboard: false,
                 backdrop:false
               });
             }

            $('#i_lock_screen').click(function (e) {
                console.log('lockscreen');
                $('#unlock_password').val('')
                Custombox.open({
                    target:'#custom-modal',
                    effect:'door',
                    overlayClose:'',
                    escKey:false,
                    overlaySpeed:"100",
                    overlayColor:"#36404a",
                    plugin:"custommodal"
                });
            });

            $('#unlock-btn').click(function () {
                $.ajax({
                    url: "/unlock",
                    type: "post",
                    datatype: "json",
                    data: {
                        unlock_password: $('#unlock_password').val(),
                    },
                    success: function (dataSet) {
                        console.log(dataSet.code);
                        if (dataSet.code==0) {
                            console.log('unlock success');
                            Custombox.close('#custom-modal',function(){return true;})
                            return false
                        } else {
                            console.log('unlock failure');
                            $('#unlock_password').val('')
                            $('#unlock_password').attr('placeholder','口令有误!')
                            return false
                        }
                    }
                 });

            });

            function get_privs(){
                 var tmp='';
                 var val='';
                 $('#sele_role_priv option').each(function(){
                   val=$(this).val();
                   tmp=tmp+','+val;
                 });
                 return tmp.substr(1);
            }

            $('#btn-user-change').click(function(){
                $.ajax({
                    url: "/user/edit/save",
                    type: "post",
                    datatype: "json",
                    data: {
                        userid     : $('#userid').val(),
                        loginname  : $('#login').val(),
                        username   : $('#user').val(),
                        password   : $('#pass').val(),
                        gender     : $('#gender').val(),
                        email      : $('#email').val(),
                        phone      : $('#phone').val(),
                        dept       : $('#dept').val(),
                        expire_date: $('#expire_date').val(),
                        status     : $('#status').val(),
                        roles      : get_privs()
                    },
                    success: function (dataSet) {
                        console.log(dataSet.code, dataSet.message);
                        if (dataSet.code==0) {
                            swal("变更成功", "", "success")
                            //console.log(dataSet.code, dataSet.message);
                        } else {
                           swal(dataSet.message, "", "error")
                        }
                    }
                 })
            });

            $(document).ready(function() {

                 $(".file").click(function() {
					$('#main-container-div').load($(this).attr("id"));
				 });

                 $('#windows_main').click(function(){
                    $('#main-container-div').load("/main");
                 });

                 //load user image
                 $('#account-img-id').attr('src',$('#image_path').val()+'/'+$('#image_file').val())
                 $('#user-img-id').attr('src',$('#image_path').val()+'/'+$('#image_file').val())

            });

        </script>

    </body>
</html>