<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- App favicon -->
    <link rel="shortcut icon" href="{{ static_url('assets/images/favicon.ico')}}">
    <!-- App title -->
    <title>新建同步</title>
    <script src="{{static_url('assets/js/modernizr.min.js')}}"></script>    <!-- Sweet Alert -->
    <link href="{{static_url('plugins/bootstrap-sweetalert/sweet-alert.css')}}" rel="stylesheet" type="text/css">
</head>
<body>
   <p></p>
   <div class="col-md-6">
       <form class="form-horizontal" role="form">
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_server">*</span>同步服务器</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="sync_server" >
                        <option value='' selected = "selected">......</option>
                        {% for var in sync_server %}
                         <option value={{var[0]}} >{{var[1]}}</option>
                        {% end %}
                    </select>
               </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sour_db_server">*</span>源数据库实例</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="sour_db_server" >
                        <option value='' selected = "selected">......</option>
                        {% for var in db_server %}
                          <option value={{var[0]}} >{{var[1]}}</option>
                        {% end %}
                    </select>
               </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sour_db_name">*</span>源数据库名称</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="sour_db_name" >
                        <option value='' selected = "selected">......</option>
                    </select>
               </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sour_tab_name">*</span>源数据库表名</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="sour_tab_name" >
                        <option value='' selected = "selected">......</option>
                    </select>
               </div>
           </div>

           <div class="form-group">
              <div class="row">
                 <div class="col-md-6">
                     <div class="form-group">
                        <div>
                            <label class="col-md-2 control-label">源数据库列名</label>
                        </div>
                        <div class="col-md-10">
                            <select multiple="multiple" class="form-control" id="sele_tab_cols" >
                            </select>
                        </div>
                     </div>
                 </div>
                 <div class="col-md-4">
                   <div class="form-group">
                        <div>
                            <label class="col-md-2 control-label">选择同步列名</label>
                        </div>
                         <div class="col-md-10">
                            <select multiple="multiple" class="form-control" id="sele_tab_sync_cols" >
                            </select>
                         </div>
                   </div>
                 </div>
              </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_desc_db_server">*</span>目标数据库</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="desc_db_server" >
                        <option value='' selected = "selected">......</option>
                        {% for var in db_server %}
                          <option value={{var[0]}} >{{var[1]}}</option>
                        {% end %}
                    </select>
               </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_tag">*</span>同步标识号</label>
                </div>
                <div class="col-md-10">
                    <input id="sync_tag"  type="text" class="form-control" placeholder="请输入同步标识号">
                </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_ywlx">*</span>同步业务类型</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="sync_ywlx" >
                        <option value='' selected = "selected">......</option>
                        {% for var in dm_sync_ywlx %}
                          <option value={{var[0]}} >{{var[1]}}</option>
                        {% end %}
                    </select>
               </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_data_type">*</span>同步数据方向</label>
                </div>
               <div class="col-md-10">
                    <select class="form-control select" id="sync_data_type" >
                        <option value='' selected = "selected">......</option>
                        {% for var in dm_sync_data_type %}
                          <option value={{var[0]}} >{{var[1]}}</option>
                        {% end %}
                    </select>
               </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_script_base">*</span>同步主目录</label>
                </div>
                <div class="col-md-10">
                    <input id="script_base"  type="text" class="form-control" placeholder="请输入同步主目录">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_script_name">*</span>同步脚本名</label>
                </div>
                <div class="col-md-10">
                    <input id="script_name"  type="text" class="form-control" placeholder="请输入备份脚本名">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_run_time">*</span>运行时间</label>
                </div>
                <div class="col-md-10">
                    <input id="run_time"  type="text" class="form-control" placeholder="请输入备份运行时间">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_task_desc">*</span>任务描述</label>
                </div>
                <div class="col-md-10">
                    <input id="task_desc"  type="text" class="form-control"  placeholder="请输入任务描述">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_python3_home">*</span>PYTHON3主目录</label>
                </div>
                <div class="col-md-10">
                    <input id="python3_home"  type="text" class="form-control" placeholder="请输入PYTHON3主目录">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_schema">*</span>同步数据库名</label>
                </div>
                <div class="col-md-10">
                    <input id="sync_schema"  type="text" class="form-control" placeholder="请输入同步数据库名">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_tables">*</span>同步表列表</label>
                </div>
                <div class="col-md-10">
                    <input id="sync_tables"  type="text" class="form-control" placeholder="请输入同步表">
                </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_sync_gap">*</span>同步间隔</label>
                </div>
                <div class="col-md-10">
                    <input id="sync_gap"  type="text" class="form-control" placeholder="请输入同步间隔"  value="10" >
                </div>
           </div>

           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_api_server">*</span>API服务器</label>
                </div>
                <div class="col-md-10">
                    <input id="api_server"  type="text" class="form-control" placeholder="请输入API服务器">
                </div>
           </div>
           <div class="form-group">
                <div>
                    <label class="col-md-2 control-label"><span id="s_status">*</span>任务状态</label>
                </div>
                <div class="col-md-10">
                    <select class="form-control select" id="status" name="status">
                        <option value="1">启用</option>
                        <option value="0">禁用</option>
                    </select>
                </div>
            </div>

           <br>
           <div class="form-group m-b-0">
                <div class="col-sm-offset-6 col-sm-9">
                  <button id="add" type="button" class="btn btn-custom waves-effect waves-light btn-md">保存</button>
                </div>
           </div>
       </form>
    </div>

    <!-- Counter js  -->
    <script src="{{static_url('plugins/counterup/jquery.counterup.min.js')}}"></script>
    <!-- Sweet-Alert  -->
    <script src="{{static_url('plugins/bootstrap-sweetalert/sweet-alert.min.js')}}"></script>

    <script>

        function set_selected(){
            document.all['s_sync_server'].style.color="#ff0000";
            document.all['s_sour_db_server'].style.color="#ff0000";
            document.all['s_desc_db_server'].style.color="#ff0000";
            document.all['s_sync_tag'].style.color="#ff0000";
            document.all['s_sync_ywlx'].style.color="#ff0000";
            document.all['s_sync_data_type'].style.color="#ff0000";
            document.all['s_script_base'].style.color="#ff0000";
            document.all['s_script_name'].style.color="#ff0000";
            document.all['s_sync_schema'].style.color="#ff0000";
            document.all['s_sync_tables'].style.color="#ff0000";
            document.all['s_run_time'].style.color="#ff0000";
            document.all['s_task_desc'].style.color="#ff0000";
            document.all['s_python3_home'].style.color="#ff0000";
            document.all['s_api_server'].style.color="#ff0000";
            document.all['s_status'].style.color="#ff0000";
            document.all['s_sync_batch_size'].style.color="#ff0000";
            document.all['s_sync_batch_size_incr'].style.color="#ff0000";
            document.all['s_sync_gap'].style.color="#ff0000";
            document.all['s_sync_col_name'].style.color="#ff0000";
            document.all['s_sync_col_val'].style.color="#ff0000";
            document.all['s_sync_time_type'].style.color="#ff0000";

        }

        $(document).ready(function() {
           set_selected();

          $("#add").click(function () {
            $.ajax({
                url: "/sync/add/save",
                type: "post",
                datatype: "json",
                data: {
                    sync_server          : $('#sync_server').val(),
                    sour_db_server       : $('#sour_db_server').val(),
                    desc_db_server       : $('#desc_db_server').val(),
                    sync_tag             : $('#sync_tag').val(),
                    sync_ywlx            : $('#sync_ywlx').val(),
                    sync_data_type       : $('#sync_data_type').val(),
                    script_base          : $('#script_base').val(),
                    script_name          : $('#script_name').val(),
                    run_time             : $('#run_time').val(),
                    task_desc            : $('#task_desc').val(),
                    python3_home         : $('#python3_home').val(),
                    sync_schema          : $('#sync_schema').val(),
                    sync_tables          : $('#sync_tables').val(),
                    sync_batch_size      : $('#sync_batch_size').val(),
                    sync_batch_size_incr : $('#sync_batch_size_incr').val(),
                    sync_gap             : $('#sync_gap').val(),
                    sync_col_name        : $('#sync_col_name').val(),
                    sync_col_val         : $('#sync_col_val').val(),
                    sync_time_type       : $('#sync_time_type').val(),
                    api_server           : $('#api_server').val(),
                    status               : $('#status').val()
                },
                success: function (dataSet) {
                    console.log(dataSet.code, dataSet.message);
                    if (dataSet.code==0) {
                       swal("保存成功", "", "success")
                    } else {
                       swal(dataSet.message, "", "error")
                    }
                }
             });
          });

        });

        $('#sour_db_server').change(function() {
            console.log('sour_db_server=',$('#sour_db_server').val());
            if ($('#sour_db_server').val()!=''){
                $.ajax({
                      url: "/get_database",
                      type: "post",
                      datatype: "json",
                      data:{
                          dbid : $('#sour_db_server').val(),
                      },
                      success: function (dataSet) {
                         $("#sour_db_name").empty();
                         $("#sour_db_name").append("<option value=''>...</option>");
                         for(i=0;i<dataSet['message'].length;i++){
                              var val  = dataSet['message'][i];
                              var text = dataSet['message'][i];
                              $("#sour_db_name").append("<option value='"+val+"'>"+text+"</option>");
                         }
                      }
                });
            } else {
                $("#sour_db_name").empty();
                $("#sour_db_name").append("<option value=''>...</option>");
            }
     });

     $('#sour_db_name').change(function() {
            console.log('sour_db_server=',$('#sour_db_server').val());
            console.log('sour_db_name=',$('#sour_db_name').val());

            if ($('#sour_db_name').val()!=''){
                $.ajax({
                      url: "/get_tables",
                      type: "post",
                      datatype: "json",
                      data:{
                          dbid    : $('#sour_db_server').val(),
                          db_name : $('#sour_db_name').val(),
                      },
                      success: function (dataSet) {
                         console.log(dataSet)
                         $("#sour_tab_name").empty();
                         $("#sour_tab_name").append("<option value=''>...</option>");
                         for(i=0;i<dataSet['message'].length;i++){
                              var val  = dataSet['message'][i];
                              var text = dataSet['message'][i];
                              $("#sour_tab_name").append("<option value='"+val+"'>"+text+"</option>");
                         }
                      }
                });
            } else {
                $("#sour_tab_name").empty();
                $("#sour_tab_name").append("<option value=''>...</option>");
            }
     });


   </script>
</body>

</html>